<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital EMR System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .sidebar { transition: all 0.3s ease; position: relative; z-index: 40; }
        .sidebar-tooltip {
            position: absolute; left: 100%; top: 50%; transform: translateY(-50%);
            background: #1f2937; color: white; padding: 4px 8px; border-radius: 4px;
            font-size: 12px; opacity: 0; pointer-events: none; transition: opacity 0.2s;
            white-space: nowrap; margin-left: 10px; z-index: 50;
        }
        .sidebar-item:hover .sidebar-tooltip { opacity: 1; }
        #rightPanel { box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        .input-field:focus { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
        .view-toggle-btn.active { background-color: white; color: #2563eb; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .hidden-view { display: none !important; }
        .autocomplete-list { position: absolute; z-index: 20; max-height: 200px; overflow-y: auto; background: white; border: 1px solid #e5e7eb; width: 100%; }
    </style>
</head>
<body class="bg-gray-50 font-sans overflow-hidden">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-md z-50 relative">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <i data-feather="activity" class="w-6 h-6"></i>
                <h1 class="text-xl font-bold">Hospital EMR System</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span class="hidden md:inline" id="doc-name-display">Dr. John Doe</span>
                <div class="w-8 h-8 rounded-full bg-blue-400 flex items-center justify-center">
                    <i data-feather="user" class="w-4 h-4"></i>
                </div>
            </div>
        </div>
    </header>

    <div class="flex h-[calc(100vh-64px)] relative" id="mainContent">
        <!-- Sidebar -->
        <aside class="sidebar bg-gray-800 text-white w-16 flex flex-col flex-shrink-0 z-40 shadow-lg">
            <div class="p-4 border-b border-gray-700 flex justify-center">
                <a href="APPOINTMENTS.html" class="sidebar-item relative p-2 rounded hover:bg-gray-700 text-gray-300 hover:text-white transition-colors">
                    <i data-feather="arrow-left" class="w-5 h-5"></i>
                    <span class="sidebar-tooltip">Back to Appointments</span>
                </a>
            </div>
            <div class="flex-grow flex flex-col items-center py-6 space-y-6">
                <button id="sidebarHistoryBtn" class="sidebar-item relative p-3 rounded-xl hover:bg-gray-700 text-gray-300 hover:text-white transition-all">
                    <i data-feather="clock" class="w-5 h-5"></i>
                    <span class="sidebar-tooltip">Past EMR History</span>
                </button>
                <button id="sidebarLabBtn" class="sidebar-item relative p-3 rounded-xl hover:bg-gray-700 text-gray-300 hover:text-white transition-all">
                    <i data-feather="activity" class="w-5 h-5"></i>
                    <span class="sidebar-tooltip">Lab Results</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-grow overflow-auto p-6 bg-gray-50 relative">
            <div class="container mx-auto px-0 space-y-6 max-w-5xl">
                
                <!-- Patient Data Section -->
                <section class="form-section bg-white rounded-lg p-6 w-full">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Patient Data</h2>
                    <div class="flex flex-col md:flex-row gap-6">
                        <!-- Patient Info Card -->
                        <div class="bg-blue-50 rounded-lg p-4 flex-1 border-l-4 border-blue-500">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                    <i data-feather="user" class="text-blue-500 w-5 h-5"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-gray-800" id="pt-name">Loading...</h3>
                                    <p class="text-sm text-gray-600" id="pt-details">--</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between border-b border-blue-100 pb-2">
                                    <span class="text-sm font-medium text-gray-600">MRN</span>
                                    <span class="text-sm font-semibold text-gray-800" id="pt-id">--</span>
                                </div>
                                <div class="flex justify-between border-b border-blue-100 pb-2">
                                    <span class="text-sm font-medium text-gray-600">BMI</span>
                                    <span class="text-sm font-semibold text-gray-800" id="bmi">N/A</span>
                                </div>
                            </div>
                        </div>

                        <!-- Vital Signs Card -->
                        <div class="bg-white border rounded-lg p-4 flex-1 shadow-sm">
                            <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <i data-feather="activity" class="w-4 h-4 mr-2 text-blue-500"></i>
                                Vital Signs
                            </h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 rounded p-3">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Weight</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="weight" class="input-field w-full px-2 py-1 border border-gray-200 rounded-md">
                                        <span class="text-gray-800">kg</span>
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded p-3">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Height</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="height" class="input-field w-full px-2 py-1 border border-gray-200 rounded-md">
                                        <span class="text-gray-800">cm</span>
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded p-3">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">BP</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="systolic" class="input-field w-20 px-2 py-1 border border-gray-200 rounded-md">
                                        <span class="text-gray-400">/</span>
                                        <input type="text" id="diastolic" class="input-field w-20 px-2 py-1 border border-gray-200 rounded-md">
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded p-3">
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Temp</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="temperature" class="input-field w-full px-2 py-1 border border-gray-200 rounded-md">
                                        <span class="text-gray-800">Â°C</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- VIEW TOGGLE SWITCH -->
                <div class="flex justify-center w-full my-4">
                    <div class="bg-gray-200 p-1 rounded-lg inline-flex shadow-inner">
                        <button class="view-toggle-btn px-6 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 focus:outline-none" onclick="switchView('nurse')">Nurse Notes</button>
                        <button class="view-toggle-btn active px-6 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 focus:outline-none" onclick="switchView('doctor')">Doctor Consultation</button>
                        <button id="summaryToggleBtn" class="view-toggle-btn px-6 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 flex items-center focus:outline-none" onclick="switchView('summary')">Visit Summary</button>
                    </div>
                </div>

                <!-- NURSE VIEW -->
                <div id="nurseView" class="hidden-view space-y-6">
                    <section class="form-section bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Nurse Triage Assessment</h2>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Nurse Notes</label>
                            <p class="text-sm text-gray-700 leading-relaxed" id="nurse-notes-text">Loading...</p>
                            <div class="mt-2 flex gap-4 text-xs text-gray-500">
                                <span>Pain Score: <b id="pain-score">--</b></span>
                                <span>Location: <b id="pain-location">--</b></span>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- DOCTOR VIEW -->
                <div id="doctorView" class="space-y-6">
                    <!-- Anamnesis -->
                    <section class="form-section bg-white rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Anamnesis</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Chief Complaint</label>
                            <textarea id="chiefComplaintInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md h-32"></textarea>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">History of Present Illness</label>
                            <textarea id="historyInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md h-32"></textarea>
                        </div>
                    </section>

                    <!-- Analysis -->
                    <section class="form-section bg-white rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Analysis</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-xs font-medium text-gray-500 mb-1">Primary Diagnosis</label>
                                <input type="text" id="primaryDiagnosisInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="relative">
                                <label class="block text-xs font-medium text-gray-500 mb-1">ICD-10 Code</label>
                                <input type="text" id="primaryICDInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-blue-700">
                                <div id="primaryICDSuggestions" class="autocomplete-list hidden"></div>
                            </div>
                        </div>
                        
                        <!-- Comorbidities -->
                        <div class="mt-4">
                            <label class="block text-xs font-medium text-gray-500 mb-1">Secondary Diagnoses</label>
                            <div class="flex gap-2 mb-2">
                                <div class="relative flex-grow">
                                    <input type="text" id="comorbidityInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Add diagnosis...">
                                    <div id="comorbiditySuggestions" class="autocomplete-list hidden"></div>
                                </div>
                                <button id="addComorbidityBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm border border-gray-300">Add</button>
                            </div>
                            <div id="comorbidityList" class="flex flex-wrap gap-2 min-h-[40px] p-2 bg-gray-50 rounded-lg border border-dashed border-gray-300"></div>
                        </div>

                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Clinical Notes</label>
                            <textarea id="analysisNotesInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md h-24"></textarea>
                        </div>
                    </section>

                    <!-- Treatment -->
                    <section class="form-section bg-white rounded-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Treatment</h2>
                        <textarea id="therapyInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-md h-24" placeholder="Therapy instructions..."></textarea>
                        
                        <!-- Follow Up -->
                        <div class="mt-4 flex items-center">
                            <input type="checkbox" id="followUpCheck" class="h-4 w-4 text-blue-600 rounded">
                            <label for="followUpCheck" class="ml-2 text-sm text-gray-700">Schedule Follow-up?</label>
                        </div>
                        <div id="followUpDateGroup" class="mt-2 hidden">
                            <input type="date" id="followUpDate" class="input-field px-3 py-2 border border-gray-300 rounded-md">
                        </div>

                        <!-- Prescription Widget -->
                        <div class="mt-4 bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                            <h4 class="font-semibold text-gray-800 text-sm mb-3">Add Drug</h4>
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-3 mb-3">
                                <div class="md:col-span-4"><input type="text" id="drugName" class="input-field w-full px-3 py-2 rounded-lg border border-gray-300 text-sm" placeholder="Drug Name"></div>
                                <div class="md:col-span-3"><input type="text" id="dosage" class="input-field w-full px-3 py-2 rounded-lg border border-gray-300 text-sm" placeholder="Dose (500mg)"></div>
                                <div class="md:col-span-3"><input type="text" id="schedule" class="input-field w-full px-3 py-2 rounded-lg border border-gray-300 text-sm" placeholder="Freq (3x1)"></div>
                                <div class="md:col-span-2"><button id="addPrescription" class="w-full bg-blue-600 text-white rounded-lg py-2 text-sm">Add</button></div>
                            </div>
                            <!-- Bulk -->
                            <div class="mb-3 relative">
                                <textarea id="bulkDrugsInput" class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg h-16 text-sm bg-gray-50 font-mono" placeholder="Bulk: Paracetamol 500mg 3x1"></textarea>
                                <button id="parseBulkBtn" class="absolute bottom-2 right-2 bg-white border border-gray-300 text-xs px-3 py-1 rounded shadow-sm hover:bg-gray-50">Parse</button>
                            </div>
                            <div id="prescriptionList" class="mt-4 divide-y divide-gray-100"></div>
                        </div>
                    </section>
                    
                    <!-- Footer Actions (Doctor View) -->
                    <div class="flex justify-end pt-6 pb-12">
                        <button id="submitDoctorView" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-lg">
                            Finalize & Submit
                        </button>
                    </div>
                </div>

                <!-- SUMMARY VIEW -->
                <div id="summaryView" class="hidden-view space-y-6">
                    <section class="bg-white rounded-lg p-8 shadow-sm border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Visit Summary</h2>
                        <div class="grid grid-cols-2 gap-8 mb-8">
                            <div>
                                <h3 class="text-xs font-bold text-blue-600 uppercase mb-2">Subjective</h3>
                                <p class="text-sm text-gray-700" id="summaryCC">--</p>
                                <p class="text-sm text-gray-700 mt-2" id="summaryHistory">--</p>
                            </div>
                            <div>
                                <h3 class="text-xs font-bold text-green-600 uppercase mb-2">Objective</h3>
                                <p class="text-sm text-gray-700">BP: <span id="summaryBP">--</span></p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-purple-600 uppercase mb-2">Diagnosis</h3>
                            <p class="text-sm text-gray-700" id="summaryDiagnosis">--</p>
                        </div>
                        <div class="mt-4">
                            <h3 class="text-xs font-bold text-gray-600 uppercase mb-2">Plan</h3>
                            <p class="text-sm text-gray-700" id="summaryInstructions">--</p>
                            <div class="text-sm text-gray-800 mt-1" id="summaryMeds">--</div>
                        </div>
                        <div class="mt-8 flex justify-end">
                            <!-- Unique ID for Summary Submit -->
                            <button id="submitSummaryView" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Finalize & Submit</button>
                        </div>
                    </section>
                </div>

                <!-- Actions -->
                <div id="actionButtons" class="flex justify-end space-x-4 pb-10">
                    <button class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Save Draft</button>
                    <button id="reviewBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center">
                        Review & Sign <i data-feather="arrow-right" class="w-4 h-4 ml-2"></i>
                    </button>
                </div>

            </div>
        </main>

        <!-- Right Panel -->
        <div id="rightPanel" class="fixed right-0 top-0 h-full bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 w-[30%] min-w-[350px] border-l border-gray-200 flex flex-col">
            <div class="p-4 bg-gray-100 border-b flex justify-between items-center">
                <h3 id="rightPanelTitle" class="font-bold text-gray-700">Panel</h3>
                <button id="closeRightPanel" class="text-gray-500 hover:text-red-500"><i data-feather="minimize-2" class="w-5 h-5"></i></button>
            </div>
            <div class="flex-grow overflow-y-auto p-4 hidden" id="labContent"></div>
            <div class="flex-grow overflow-y-auto p-4 hidden" id="historyContent"></div>
        </div>
    </div>

    <!-- Logic -->
    <script src="doctor_logic.js"></script>
    <script>
        AOS.init();
        feather.replace();
    </script>
</body>
</html>
